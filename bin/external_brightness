#!/usr/bin/env bash

## Copyright (C) 2020-2021 Aditya Shakya <adi1090x@gmail.com>
## Everyone is permitted to copy and distribute copies of this file under GNU-GPL3
## Modified by Febri Eka Setyawan for configuring external monitor brightness

## Script To Manage Brightness For External Monitor
# let current_value
# Get brightness
current_value=`xrandr --verbose | grep Brightness | grep -o '[0-9].*' | tail -n 1`
LIGHT=`echo "$current_value*100/1" | bc`
get_backlight() {
  echo "${LIGHT}%"
}

get_backlight_value() {
	echo "$current_value"
}

# Get icons
get_icon() {
	backlight="$(get_backlight)"
	current="${backlight%%%}"
	if [[ ("$current" -ge "0") && ("$current" -le "20") ]]; then
		icon='/usr/share/archcraft/icons/dunst/brightness-20.png'
	elif [[ ("$current" -ge "20") && ("$current" -le "40") ]]; then
		icon='/usr/share/archcraft/icons/dunst/brightness-40.png'
	elif [[ ("$current" -ge "40") && ("$current" -le "60") ]]; then
		icon='/usr/share/archcraft/icons/dunst/brightness-60.png'
	elif [[ ("$current" -ge "60") && ("$current" -le "80") ]]; then
		icon='/usr/share/archcraft/icons/dunst/brightness-80.png'
	elif [[ ("$current" -ge "80") && ("$current" -le "100") ]]; then
		icon='/usr/share/archcraft/icons/dunst/brightness-100.png'
	fi
}

# Get icons
get_polybar() {
	backlight="$(get_backlight)"
	current="${backlight%%%}"
  magenta=$(xrdb -query | grep 'color5:'| awk '{print $NF}')
	if [[ ("$current" -ge "30") && ("$current" -le "50") ]]; then
		icon=''
	elif [[ ("$current" -ge "60") && ("$current" -le "80") ]]; then
		icon=''
	elif [[ ("$current" -ge "80") && ("$current" -le "100") ]]; then
		icon=''
	fi
  echo "%{F$magenta}$icon%{F-} $backlight"
}

# Increase brightness
inc_backlight() {
  new=`echo "$current_value+0.1" | bc`
  LIGHT=`echo "$LIGHT+10" | bc`
  # echo "$new"
  xrandr --output HDMI2 --brightness "$new" && get_icon && dunstify -u low --replace=69 -i "$icon" "Brightness : $(get_backlight)"
}

# Decrease brightness
dec_backlight() {
  new=`echo "$current_value-0.1" | bc`
  LIGHT=`echo "$LIGHT-10" | bc`
  # echo "$new"
  xrandr --output HDMI2 --brightness "$new" && get_icon && dunstify -u low --replace=69 -i "$icon" "Brightness : $(get_backlight)"
}

# Set brightness
set_backlight() {
	xrandr --output HDMI2 --brightness "$1" && get_icon && dunstify -u low --replace=69 -i "$icon" "Brightness : $(get_backlight)"
}

# Execute accordingly
if [[ "$1" == "--get" ]]; then
  get_backlight_value
elif [[ "$1" == "--inc" ]]; then
  if (( "$LIGHT" == 100 )); then
    # dunstify "Fuck"
    get_icon && dunstify -u low --replace=69 -i "$icon" "Brightness : $(get_backlight)"
    exit 1;
  fi
	inc_backlight
elif [[ "$1" == "--dec" ]]; then
  if (( "$LIGHT" == 30 )); then
    # dunstify "Fuck"
    get_icon && dunstify -u low --replace=69 -i "$icon" "Brightness : $(get_backlight)"
    exit 1;
  fi
	dec_backlight
elif [[ "$1" == "--set" ]]; then
	# take the value from parameter 2 => --set "value"
  set_backlight "$2"
elif [[ "$1" == "--polybar" ]]; then
  get_polybar
else
	get_backlight
fi